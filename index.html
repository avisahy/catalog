<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Catalog PWA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#121212" />
  <link rel="manifest" href="manifest.json" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div id="app" class="app app-theme-default app-font-medium app-layout-3">
    <!-- Offline indicator -->
    <div id="offline-indicator" class="offline-indicator hidden">
      <span>Offline</span>
    </div>

    <!-- Top bar -->
    <header class="app-header">
      <div class="logo" id="app-logo">
        <span class="logo-icon">üì¶</span>
        <span class="logo-text">Catalog</span>
      </div>
      <div class="header-actions">
        <button id="install-btn" class="btn btn-ghost small hidden">Install</button>
        <button id="voice-search-btn" class="btn btn-ghost small" title="Voice search">
          üéô
        </button>
        <label class="toggle">
          <input type="checkbox" id="theme-toggle" />
          <span class="toggle-slider"></span>
        </label>
      </div>
    </header>

    <!-- Navigation -->
    <nav class="app-nav">
      <button class="nav-btn active" data-view="home-view">Home</button>
      <button class="nav-btn" data-view="stats-view">Stats</button>
      <button class="nav-btn" data-view="settings-view">Settings</button>
    </nav>

    <!-- Page transition container -->
    <main class="app-main">
      <!-- Home / Catalog View -->
      <section id="home-view" class="view active">
        <!-- Search and filters -->
        <div class="toolbar">
          <div class="search-box">
            <input
              type="search"
              id="search-input"
              placeholder="Search by name or location"
              autocomplete="off"
            />
          </div>
          <div class="toolbar-actions">
            <button id="filter-favorites-btn" class="btn btn-ghost small" title="Toggle favorites filter">
              ‚òÖ
            </button>
            <button id="batch-toggle-btn" class="btn btn-ghost small">
              Batch
            </button>
          </div>
        </div>

        <!-- Batch actions bar -->
        <div id="batch-bar" class="batch-bar hidden">
          <span id="batch-count">0 selected</span>
          <div class="batch-actions">
            <button id="batch-favorite-btn" class="btn small">Favorite</button>
            <button id="batch-export-btn" class="btn small">Export</button>
            <button id="batch-share-btn" class="btn small">Share</button>
            <button id="batch-delete-btn" class="btn btn-danger small">Delete</button>
          </div>
        </div>

        <!-- Skeleton loader -->
        <div id="skeleton-container" class="grid">
          <div class="card skeleton"></div>
          <div class="card skeleton"></div>
          <div class="card skeleton"></div>
          <div class="card skeleton"></div>
        </div>

        <!-- Catalog grid -->
        <div id="catalog-grid" class="grid hidden"></div>
      </section>

      <!-- Stats View -->
      <section id="stats-view" class="view">
        <h2>Statistics</h2>
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-label">Total items</div>
            <div id="stat-total-items" class="stat-value">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Favorites</div>
            <div id="stat-favorites" class="stat-value">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Last backup</div>
            <div id="stat-last-backup" class="stat-value">Never</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Auto-backups</div>
            <div id="stat-auto-backups" class="stat-value">0</div>
          </div>
        </div>
        <h3>Recently added</h3>
        <ul id="recent-items-timeline" class="timeline"></ul>
      </section>

      <!-- Settings View -->
      <section id="settings-view" class="view">
        <h2>Settings</h2>
        <div class="settings-section">
          <h3>Appearance</h3>
          <div class="setting-row">
            <label>Text size</label>
            <div class="setting-options">
              <button data-font="small" class="btn btn-ghost small font-btn">Small</button>
              <button data-font="medium" class="btn btn-ghost small font-btn active">Medium</button>
              <button data-font="large" class="btn btn-ghost small font-btn">Large</button>
            </div>
          </div>

          <div class="setting-row">
            <label>Card layout</label>
            <div class="setting-options">
              <button data-layout="2" class="btn btn-ghost small layout-btn">2 cols</button>
              <button data-layout="3" class="btn btn-ghost small layout-btn active">3 cols</button>
              <button data-layout="4" class="btn btn-ghost small layout-btn">4 cols</button>
            </div>
          </div>

          <div class="setting-row">
            <label>Color theme</label>
            <div class="setting-options">
              <button data-theme="default" class="btn btn-ghost small theme-btn active">Default</button>
              <button data-theme="blue" class="btn btn-ghost small theme-btn">Blue</button>
              <button data-theme="sunset" class="btn btn-ghost small theme-btn">Sunset</button>
            </div>
          </div>
        </div>

        <div class="settings-section">
          <h3>Backup & data</h3>
          <div class="setting-row">
            <label>Backup reminder (days)</label>
            <input id="backup-reminder-days" type="number" min="1" max="30" value="3" />
          </div>
          <div class="setting-row">
            <button id="manual-backup-btn" class="btn">Export all as JSON</button>
            <button id="manual-import-btn" class="btn">Import JSON</button>
            <input id="import-file-input" type="file" accept="application/json" hidden />
          </div>
          <div class="setting-row">
            <button id="delete-all-btn" class="btn btn-danger">
              Delete all data
            </button>
          </div>
        </div>
      </section>
    </main>

    <!-- Floating Action Button -->
    <button id="fab-add-item" class="fab" title="Add item">+</button>

    <!-- Add/Edit Item Modal -->
    <div id="item-form-modal" class="modal hidden">
      <div class="modal-backdrop"></div>
      <div class="modal-content card-3d">
        <header class="modal-header">
          <h2 id="item-form-title">Add item</h2>
          <button class="btn-icon" id="item-form-close-btn">‚úï</button>
        </header>
        <div class="modal-body">
          <form id="item-form">
            <input type="hidden" id="item-id" />
            <div class="form-group">
              <label for="item-name">Name</label>
              <input id="item-name" type="text" required />
            </div>
            <div class="form-group">
              <label for="item-location">Location</label>
              <input id="item-location" type="text" required />
            </div>
            <div class="form-group">
              <label for="item-image">Image</label>
              <input id="item-image" type="file" accept="image/*" />
              <small>Leave empty to keep current image when editing.</small>
            </div>
          </form>
        </div>
        <footer class="modal-footer">
          <button id="item-form-cancel-btn" class="btn btn-ghost">Cancel</button>
          <button id="item-form-save-btn" class="btn">Save</button>
        </footer>
      </div>
    </div>

    <!-- Item Preview Modal -->
    <div id="item-preview-modal" class="modal hidden">
      <div class="modal-backdrop"></div>
      <div class="modal-content card-3d preview-modal">
        <header class="modal-header">
          <button id="preview-close-btn" class="btn-icon">‚Üê</button>
          <h2 id="preview-name"></h2>
          <button id="preview-favorite-btn" class="btn-icon" title="Toggle favorite">‚òÜ</button>
        </header>
        <div class="modal-body preview-body">
          <div class="preview-image-container">
            <img id="preview-image" alt="Item image" />
          </div>
          <div class="preview-meta">
            <div class="preview-row">
              <span class="label">Location</span>
              <span id="preview-location" class="value"></span>
            </div>
          </div>
          <div class="preview-actions">
            <button id="preview-export-btn" class="btn small">Export</button>
            <button id="preview-share-wa-btn" class="btn small">WhatsApp</button>
            <button id="preview-share-qr-btn" class="btn small">QR</button>
            <button id="preview-share-link-btn" class="btn small">Link</button>
          </div>
          <div class="preview-actions">
            <button id="preview-delete-btn" class="btn btn-danger small">Delete</button>
          </div>
          <div class="preview-hint">
            Swipe left/right or use ‚Üê ‚Üí keys to navigate. Double-tap image for full screen. Pinch to zoom.
          </div>
        </div>
      </div>
    </div>

    <!-- QR Modal -->
    <div id="qr-modal" class="modal hidden">
      <div class="modal-backdrop"></div>
      <div class="modal-content card-3d">
        <header class="modal-header">
          <h2>Share via QR</h2>
          <button class="btn-icon" id="qr-close-btn">‚úï</button>
        </header>
        <div class="modal-body">
          <canvas id="qr-canvas" width="256" height="256"></canvas>
        </div>
      </div>
    </div>

    <!-- Import conflict dialog -->
    <div id="import-dialog" class="modal hidden">
      <div class="modal-backdrop"></div>
      <div class="modal-content card-3d">
        <header class="modal-header">
          <h2>Import options</h2>
        </header>
        <div class="modal-body">
          <p>Choose how to import items:</p>
          <div class="import-options">
            <button id="import-merge-btn" class="btn">Merge all</button>
            <button id="import-replace-btn" class="btn btn-danger">Replace all</button>
            <button id="import-select-btn" class="btn">Select items</button>
          </div>
          <div id="import-select-list" class="import-select-list hidden"></div>
          <div id="import-errors" class="import-errors hidden"></div>
        </div>
        <footer class="modal-footer">
          <button id="import-dialog-close-btn" class="btn btn-ghost">Close</button>
          <button id="import-apply-btn" class="btn hidden">Apply selection</button>
        </footer>
      </div>
    </div>

    <!-- Snackbar -->
    <div id="snackbar" class="snackbar hidden">
      <span id="snackbar-message"></span>
      <button id="snackbar-action-btn" class="btn btn-link small"></button>
    </div>

    <!-- Backup reminder banner -->
    <div id="backup-reminder-banner" class="banner hidden">
      <span>No backup in a while. Export your data now.</span>
      <button id="backup-reminder-btn" class="btn small">Backup</button>
      <button id="backup-reminder-dismiss-btn" class="btn btn-ghost small">Dismiss</button>
    </div>
  </div>

  <script src="db.js"></script>
  <script src="script.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('service-worker.js');
      });
    }
  </script>
</body>
</html>
