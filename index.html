<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0, viewport-fit=cover"
  />
  <title>Catalog PWA</title>

  <link rel="manifest" href="manifest.json" />
  <link rel="stylesheet" href="style.css" />

  <meta name="theme-color" content="#121212" />
  <link rel="icon" href="icons/icon-192.png" />

  <script>
    // Theme + layout + text size early apply to avoid flash
    (function applyInitialPreferences() {
      try {
        const prefs = JSON.parse(localStorage.getItem("catalog_prefs") || "{}");
        if (prefs.theme) document.documentElement.dataset.theme = prefs.theme;
        if (prefs.mode) document.documentElement.dataset.mode = prefs.mode;
        if (prefs.layout) document.documentElement.dataset.layout = prefs.layout;
        if (prefs.textSize)
          document.documentElement.dataset.textSize = prefs.textSize;
      } catch (e) {}
    })();
  </script>
</head>
<body>
  <div id="app">
    <header class="app-header">
      <div class="logo-container" role="button" tabindex="0" id="logoHome">
        <div class="logo-3d">C</div>
        <span class="logo-text">Catalog</span>
      </div>

      <div class="header-center">
        <div class="search-container">
          <input
            id="searchInput"
            type="text"
            placeholder="Search by name or location..."
          />
          <button id="voiceSearchBtn" class="icon-btn" title="Voice search">
            ðŸŽ™
          </button>
        </div>
      </div>

      <div class="header-actions">
        <button id="favoritesFilterBtn" class="icon-btn" title="Filter favorites">
          â˜…
        </button>

        <label class="switch" title="Toggle dark / light mode">
          <input type="checkbox" id="modeToggle" />
          <span class="slider"></span>
        </label>

        <div class="offline-indicator" id="offlineIndicator" title="Offline">
          â­•
        </div>
      </div>
    </header>

    <nav class="bottom-nav">
      <button class="nav-btn active" data-view="homeView">Home</button>
      <button class="nav-btn" data-view="statsView">Stats</button>
      <button class="nav-btn" data-view="settingsView">Settings</button>
      <button class="nav-btn" data-view="backupView">Backup</button>
    </nav>

    <main id="mainViews">
      <!-- HOME VIEW -->
      <section id="homeView" class="view active">
        <div id="skeletonGrid" class="card-grid skeleton-grid"></div>
        <div id="cardGrid" class="card-grid hidden"></div>

        <div class="batch-toolbar hidden" id="batchToolbar">
          <span id="batchCount">0 selected</span>
          <button id="batchFavoriteBtn">Favorite</button>
          <button id="batchDeleteBtn">Delete</button>
          <button id="batchExportBtn">Export</button>
          <button id="batchShareBtn">Share</button>
          <button id="batchCancelBtn">Cancel</button>
        </div>
      </section>

      <!-- STATS VIEW -->
      <section id="statsView" class="view">
        <h2>Statistics</h2>
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-label">Total items</div>
            <div class="stat-value" id="statTotalItems">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Favorites</div>
            <div class="stat-value" id="statFavorites">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Last backup</div>
            <div class="stat-value" id="statLastBackup">Never</div>
          </div>
        </div>
        <h3>Recently added</h3>
        <ul id="recentTimeline" class="timeline"></ul>
      </section>

      <!-- SETTINGS VIEW -->
      <section id="settingsView" class="view">
        <h2>Settings</h2>

        <div class="settings-group">
          <h3>Theme</h3>
          <div class="chip-group" id="themeChips">
            <button data-theme="blue" class="chip">Blue</button>
            <button data-theme="purple" class="chip">Purple</button>
            <button data-theme="green" class="chip">Green</button>
            <button data-theme="orange" class="chip">Orange</button>
          </div>
        </div>

        <div class="settings-group">
          <h3>Layout</h3>
          <div class="chip-group" id="layoutChips">
            <button data-layout="2" class="chip">2 columns</button>
            <button data-layout="3" class="chip">3 columns</button>
            <button data-layout="4" class="chip">4 columns</button>
          </div>
        </div>

        <div class="settings-group">
          <h3>Text size</h3>
          <div class="chip-group" id="textSizeChips">
            <button data-size="small" class="chip">Small</button>
            <button data-size="medium" class="chip">Medium</button>
            <button data-size="large" class="chip">Large</button>
          </div>
        </div>

        <div class="settings-group">
          <h3>Danger zone</h3>
          <button id="deleteAllBtn" class="danger-btn">
            Delete all data
          </button>
        </div>
      </section>

      <!-- BACKUP VIEW -->
      <section id="backupView" class="view">
        <h2>Backup & Sync</h2>

        <div class="settings-group">
          <h3>Manual backup</h3>
          <button id="exportAllBtn">Export all as JSON</button>
          <button id="exportAllToWhatsAppBtn">
            Share all (WhatsApp / QR / link)
          </button>
        </div>

        <div class="settings-group">
          <h3>Import</h3>
          <input
            type="file"
            id="importFileInput"
            accept="application/json"
            hidden
          />
          <button id="importBtn">Import from JSON</button>
          <div id="importSummary" class="import-summary"></div>
        </div>

        <div class="settings-group">
          <h3>Backup reminders</h3>
          <p>
            Autoâ€‘backup runs daily and keeps only older backups in local
            storage. Youâ€™ll see reminders if you havenâ€™t backed up recently.
          </p>
          <button id="forceBackupCheckBtn">Check backup status</button>
        </div>
      </section>
    </main>

    <!-- ITEM PREVIEW MODAL -->
    <div id="previewOverlay" class="overlay hidden">
      <div class="preview-modal">
        <button id="previewCloseBtn" class="close-btn">âœ•</button>

        <div class="preview-image-container" id="previewImageContainer">
          <img id="previewImage" src="" alt="Item" />
        </div>

        <div class="preview-content">
          <h2 id="previewName"></h2>
          <p id="previewLocation" class="preview-location"></p>

          <div class="preview-actions">
            <button id="previewFavoriteBtn" class="icon-btn">â˜…</button>
            <button id="previewExportBtn">Export JSON</button>
            <button id="previewWhatsAppBtn">WhatsApp</button>
            <button id="previewQrBtn">QR</button>
            <button id="previewLinkBtn">Preview link</button>
            <button id="previewDeleteBtn" class="danger-btn">Delete</button>
          </div>

          <div class="preview-swipe-hint">Swipe left / right to navigate</div>
        </div>
      </div>
    </div>

    <!-- QR MODAL -->
    <div id="qrOverlay" class="overlay hidden">
      <div class="qr-modal">
        <button id="qrCloseBtn" class="close-btn">âœ•</button>
        <h2>Share as QR</h2>
        <canvas id="qrCanvas"></canvas>
      </div>
    </div>

    <!-- ADD ITEM FAB + DIALOG -->
    <button id="fab" class="fab">ï¼‹</button>

    <div id="addDialogOverlay" class="overlay hidden">
      <div class="dialog">
        <h2>Add new item</h2>
        <label>
          Name
          <input type="text" id="addNameInput" />
        </label>
        <label>
          Location
          <input type="text" id="addLocationInput" />
        </label>
        <label>
          Image
          <input type="file" id="addImageInput" accept="image/*" />
        </label>
        <div class="dialog-actions">
          <button id="addCancelBtn">Cancel</button>
          <button id="addSaveBtn">Save</button>
        </div>
      </div>
    </div>

    <!-- IMPORT CONFLICT DIALOG -->
    <div id="importConflictOverlay" class="overlay hidden">
      <div class="dialog">
        <h2>Import conflict</h2>
        <p id="importConflictText"></p>
        <div class="dialog-actions">
          <button id="importKeepExistingBtn">Keep existing</button>
          <button id="importKeepImportedBtn">Keep imported</button>
          <button id="importSkipBtn">Skip</button>
        </div>
      </div>
    </div>

    <!-- SNACKBAR -->
    <div id="snackbar" class="snackbar"></div>

    <!-- INSTALL PROMPT BANNER -->
    <div id="installBanner" class="install-banner hidden">
      <span>Add Catalog to home screen?</span>
      <div>
        <button id="installLaterBtn">Later</button>
        <button id="installNowBtn">Install</button>
      </div>
    </div>
  </div>

  <script src="db.js"></script>
  <script src="script.js"></script>
</body>
</html>
